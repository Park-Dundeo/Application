# 준서의 인생 계획 - 스프레드시트 전체 구조 분석

## 전체 아키텍처 개요

```
┌─────────────────────────────────────────────────────────────────┐
│                    준서의 인생 계획 (Google Sheets)                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────────┐   │
│  │  뱅크샐러드    │───▶│  가계부 내역   │───▶│  25.7~26.6 예산안 │   │
│  │  (뱅샐현황)    │    │  (원장/Ledger) │    │  (예산 관리)      │   │
│  │  13개월 통계   │    │  13,381건     │    │  SUMIF 집계      │   │
│  └──────────────┘    └──────┬───────┘    └────────┬─────────┘   │
│                             │                      │             │
│                    J열(메모)로 분류      K열(상세)로 SUMIF 연동    │
│                             │                      │             │
│              ┌──────────────┼──────────────────────┘             │
│              │              │                                    │
│  ┌───────────▼──┐ ┌────────▼───┐ ┌─────────┐ ┌──────────────┐  │
│  │ 프로젝트 시트  │ │ 통계 시트   │ │ 입금내역 │ │ 소비내역      │  │
│  │ 효도/선교/관계│ │23.06~24.06│ │ FILTER  │ │ FILTER      │  │
│  │ 찬양/ACS/교회│ │ 비율 분석  │ │         │ │             │  │
│  └──────────────┘ └───────────┘ └─────────┘ └──────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 1. 가계부 내역 (원장/Ledger) - 핵심 데이터 시트

**범위:** A1:Z13381 (13,381건의 거래)

### 컬럼 구조
| 열 | 헤더 | 설명 | 예시 |
|---|---|---|---|
| A | 날짜 | 거래 날짜 | 2025-12-31 |
| B | 시간 | 거래 시간 | 19:39:03 |
| C | 타입 | 지출/이체/수입 | 지출 |
| D | 대분류 | 뱅크샐러드 자동분류 | 식비, 생활, 금융 |
| E | 소분류 | 뱅크샐러드 세부분류 | 고기, 편의점, 보험 |
| F | 내용 | 가맹점/거래처명 | GS25판교알파점 |
| G | 금액 | 거래금액 (음수=지출) | -86000 |
| H | 화폐 | 통화 | KRW |
| I | 결제수단 | 카드/계좌 | Hyundai Mobility카드 |
| **J** | **메모** | **수동 대분류 태그** | **효도, 선교, 관계, 찬양, ACS** |
| **K** | **상세** | **수동 세부 태그 (예산 연동 키)** | **어머니 적금, 선교 헌금, 식비** |
| L~Q | (자동화 열) | OpenClaw 파이프라인 추가 | auto_cat, category, source 등 |

### 핵심 수식: J열 (프로젝트 자동 분류)
```
=IF(K열="어머니 적금", "효도",
 IF(K열="어머니 용돈", "효도",
  IF(K열="어머니 선물", "효도",
   IF(K열="찬양팀 회비", "찬양",
    IF(K열="모임비", "ACS",
     IF(K열="필리핀", "선교",
      IF(K열="수련회", "선교",
       IF(K열="선교 헌금", "선교",
        IF(K열="식사교제", "교회/양육",
         IF(K열="선물", "관계",
          IF(K열="동기 계모임", "관계",
           IF(K열="파트 회비", "관계",
            IF(K열="경조비", "경조사", "")))))))))))))
```
> J651~J1012+ 행에 동일 수식이 반복 적용됨

### 데이터 흐름
- **입력:** 뱅크샐러드 → Gmail 첨부 → OpenClaw 파이프라인 → 시트 삽입 (row 2~)
- **수동 태깅:** 사용자가 J열(메모)과 K열(상세)을 수동 입력
- **출력:** 예산안의 SUMIF가 K열을 참조하여 지출 집계

---

## 2. 25.7~26.6 예산안 (예산 관리 시트)

**범위:** A1:AA48

### 레이아웃 구조 (4열 x 4블록 매트릭스)

```
┌────────────────────────────────────────────────────────────────────────────────────┐
│ Row 1~3: 대시보드                                                                  │
│  B1: 현재 월차 (=month(NOW())-month(2025.07)+1)                                    │
│  E2: 월 고정 지출액  |  G2: 부족한 금액  |  Q2: 주식 34M  |  V3: 예산 70M            │
│  E3: 전월 월급 (SUMIFS)  |  G3: 본월 지출 (SUMIFS)                                  │
├─────────────────┬─────────────────┬─────────────────┬─────────────────────────────┤
│ Row 4~14:       │                 │                 │                             │
│ 내부 경영 예산   │                 │                 │                             │
│                 │                 │                 │                             │
│ [A:E] 운영비    │ [F:J] 재무관리   │ [K:O] 개발      │ [P:T] 생활                  │
│ 자동차 할부 8M  │ 저축     5M     │ 도서   600K    │ 식비   10M                  │
│ 자동차 유지 3M  │ 주식    15M     │                 │ 예비비  6M                  │
│ AI      180K   │                 │                 │                             │
│ 커플통장 2.4M  │                 │                 │                             │
│ 보험    2.4M   │                 │                 │                             │
│ 교통    480K   │                 │                 │                             │
│ 통신    1.8M   │                 │                 │                             │
│ 건강     -     │                 │                 │                             │
│ 병원    1M     │                 │                 │                             │
├─────────────────┼─────────────────┼─────────────────┼─────────────────────────────┤
│ Row 15~27:      │                 │                 │                             │
│ 프로젝트 예산   │                 │                 │                             │
│                 │                 │                 │                             │
│ [A:E] 효도     │ [F:J] 선교      │ [K:O] 여행      │ [P:T] (빈칸)                │
│ 어머니 적금 3.6M│ 필리핀   60K   │ 여수  819K     │                             │
│ 어머니 용돈 6M  │ 수련회  130K   │ 일본   2M      │                             │
│ 어머니 선물 2.5M│ 선교헌금 1.95M │ 속초  300K     │                             │
│                 │                 │                 │                             │
│ [A:E] 찬양     │ [F:J] 교회/양육 │ [K:O] (빈칸)   │ [P:T] (빈칸)                │
│ 찬양팀 회비 180K│ 식사교제 120K  │                 │                             │
│                 │                 │                 │                             │
│ [A:E] ACS      │ [F:J] 관계      │ [K:O] 경조사    │ [P:T] (빈칸)                │
│ 모임비    -    │ 선물    2M      │ 경조비  1.2M   │                             │
│                │ 동기계모임 180K │                 │                             │
│                │ 파트회비 220K   │                 │                             │
├────────────────┴─────────────────┴─────────────────┴─────────────────────────────┤
│ Row 28: V28 = 실제 총계 = SUM(V16:V27)                                           │
│ Row 29: 결과                                                                      │
├──────────────────────────────────────────────────────────────────────────────────┤
│ [Y:AA열] 예산 비율 분석 & 잔여 예산 분석                                            │
│ Y5~Y25: 카테고리별 예산 비율 (AA/AA$5)                                             │
│ Y28~Y48: 카테고리별 잔여 예산 (예산-실적)                                           │
└──────────────────────────────────────────────────────────────────────────────────┘
```

### 각 항목의 열 구조 (반복 패턴)
| 열 위치 | 헤더 | 수식 패턴 | 설명 |
|---------|------|----------|------|
| A/F/K/P | 항목명 | (고정값) | 예산 항목 이름 |
| B/G/L/Q | **월** | `=E열/12` 또는 `=J열/12` | 월간 예산액 |
| C/H/M/R | **남은 예산** | `=E열+SUMIF('가계부 내역'!$K:$K, 항목명, '가계부 내역'!$G:$G)` | 예산 - 실제지출 |
| D/I/N/S | **여분/부족분** | `=B열*$B$1+SUMIF(...)` | 현재 월까지의 예산 - 실제지출 |
| E/J/O/T | **예산** | (고정값) | 연간 예산 총액 |

### 핵심 수식 패턴

#### 남은 예산 (C열 패턴)
```
=E6+SUMIF('가계부 내역'!$K:$K, A6, '가계부 내역'!$G:$G)
```
> 연간 예산(E6) + 실제 지출 합계(G열, 음수이므로 더하면 빠짐)

#### 여분/부족분 (D열 패턴)
```
=B6*$B$1+SUMIF('가계부 내역'!$K:$K, A6, '가계부 내역'!$G:$G)
```
> 월예산 x 경과월수 + 실제 지출 합계 → 양수면 여유, 음수면 초과

#### 대시보드 수식
```
B1: =month(NOW())-month(2025.07)+1          ← 현재 경과 월수
E2: =-sum(B5,B16,B20,B24,G24,G20,...)       ← 월 고정 지출 합계
E3: =SUMIFS('가계부 내역'!G:G, ...)          ← 전월 급여
G2: =sum(E2+E3-E3*0.1)                      ← 부족한 금액 (세후)
G3: =SUMIFS('가계부 내역'!G:G, ...)          ← 본월 지출 합계
V5: =sum(E5,J5,O5,T5)                       ← 내부경영 예산 총계
V15: =V3-V5                                  ← 프로젝트 예산 잔여
```

### 발견된 수식 버그
1. **C13 (건강):** `SUMIF('가계부 내역22'!$K:$K, ...)` → 존재하지 않는 시트명 '가계부 내역22' 참조
2. **M20:** `SUMIF('가계부 내역'!$J:$J, K20, ...)` → 다른 항목은 $K:$K인데 여기만 $J:$J 참조 (오류)
3. **일부 항목에 월(B열) 수식 누락:** 어머니 선물(A19)의 B19가 비어있음

---

## 3. 뱅샐현황 (뱅크샐러드 리포트)

**범위:** A1:Z1000 (126개 병합셀)

### 구획 구조

#### 구획 1: 고객정보 (B3~F6)
```
┌──────────┬──────┬──────┬──────────┬──────┐
│ 이름     │ 성별 │ 연령 │ 신용점수 │ 이메일│
│ 박준서   │ 남   │ 29   │ 966(KCB)│ -    │
└──────────┴──────┴──────┴──────────┴──────┘
```

#### 구획 2: 현금흐름현황 (B9~Q37)
**13개월 월별 수입/지출 매트릭스 (2024-10 ~ 2025-10)**

| 구분 | 항목들 |
|------|--------|
| **수입 (Row 12~18)** | 금융수입, 급여, 기타수입, 사업수입, 용돈, 미분류 → 월수입 총계 |
| **지출 (Row 19~36)** | 경조/선물, 교육/학습, 교통, 금융, 문화/여가, 뷰티/미용, 생활, 술/유흥, 식비, 여행/숙박, 온라인쇼핑, 의료/건강, 자동차, 주거/통신, 카페/간식, 패션/쇼핑, 미분류 → 월지출 총계 |
| **순수입 (Row 37)** | =월수입-월지출 |

수식 패턴:
- C열(총계): `=SUM(E:Q)`
- D열(월평균): `=C/13`
- 총계행: `=SUM(각 항목)`

#### 구획 3: 재무현황 (B40~I85+)
```
┌─────────────────────────┬───────────────────────────┐
│ 자산 (B42~E85)          │ 부채 (F42~I85)             │
│ ├ 자유입출금 (12개 계좌)  │ ├ 장기대출                  │
│ ├ 신탁 자산              │                            │
│ ├ 현금 자산              │                            │
│ ├ 저축성 자산            │                            │
│ ├ 전자금융 자산          │                            │
│ ├ 투자성 자산 (주식 15종+)│                            │
│ E86: =SUM(E44:E85)      │ I86: =SUM(I44:I85)        │
│                         │                            │
│ B88: =E86-I86 (순자산)   │                            │
└─────────────────────────┴───────────────────────────┘
```

#### 구획 4: 자산 추이 (B90~, Row 93+)
- 계좌별 자산 추이 데이터
- F100: 총계 수식

#### 구획 5: 뱅크샐러드 관리 계좌 목록 (D104~H123)
- 은행별 계좌 목록
- 증가율 계산: `=(SUM(G)-SUM(F))*100/IF(SUM(F),SUM(F),1)`

---

## 4. 프로젝트 상세 시트들 (효도/선교/관계/교회양육/찬양/ACS)

### 공통 레이아웃 구조
```
┌──────────────────────────────────────────────────────────────┐
│ Row 1: [프로젝트명]  [월예산]  [남은예산]  [부족분]  [연예산]  │
│ Row 2~4: [세부항목별 예산 현황]                               │
│          F열: 설명                                           │
├──────────────────────────────────────────────────────────────┤
│ Row 5: 헤더 (날짜|시간|타입|대분류|소분류|내용|금액|화폐|     │
│               결제수단|메모|상세)                              │
├──────────────────────────────────────────────────────────────┤
│ Row 7+: FILTER 수식으로 자동 필터링된 거래 내역               │
│   =FILTER('가계부 내역'!$A:$K, '가계부 내역'!$J:$J = $A$1)   │
├──────────────────────────────────────────────────────────────┤
│ L열~: 계획 영역                                              │
│   L1: "계획"                                                 │
│   M2~X2: 연도 헤더 (2024, 2025)                              │
│   M3~X3: 월 헤더 (7~6, 회계연도)                              │
│   L4+: 활동/일정 항목 + 간트차트 (O/x/n 마킹)                │
└──────────────────────────────────────────────────────────────┘
```

### 시트별 상세

#### 효도 (A1:X24)
```
총 예산: ₩12,149,260 | 남은: ₩5,749,600 | 월: ₩800,000
├ 어머니 적금:  ₩3,600,000 (월 300K)  남은: ₩3,600,000
├ 어머니 용돈:  ₩6,000,000 (월 500K)  남은: ₩2,924,800
└ 어머니 선물:  ₩2,549,260            남은: -₩775,200 (초과!)
계획: 어머니 적금/펀드 개설
```

#### 선교 (A1:X24)
```
총 예산: ₩2,140,000 | 남은: ₩1,235,400 | 월: ₩178,333
├ 필리핀:     ₩60,000   남은: ₩0
├ 수련회:     ₩130,000  남은: ₩0
└ 선교 헌금:  ₩1,950,000 남은: ₩1,235,400
추가 수식: F열에 SUMIF($K:$K, "항목명", $G:$G) 로 자체 집계
계획: 필리핀, 계룡대, 수련회, 한샘교회, 프라미스 수련회
```

#### 관계 (A1:X24)
```
총 예산: ₩2,400,000 | 남은: -₩897,270 (초과!) | 월: ₩201,667
├ 선물:       ₩2,000,000 남은: -₩1,242,270 (초과!)
├ 동기 계모임: ₩180,000  남은: ₩165,000
└ 파트 회비:  ₩220,000   남은: ₩180,000
```

#### 교회/양육 (A1:X24)
```
총 예산: ₩120,000 | 남은: ₩77,950 | 월: ₩10,000
└ 식사교제: ₩120,000 남은: ₩77,950
계획: 7UP, 일대일, PW 찬양팀
```

#### 찬양 (A1:X30)
```
총 예산: ₩180,000 | 남은: ₩105,000 | 월: ₩15,000
└ 찬양팀 회비: ₩180,000 남은: ₩105,000
계획: 여름수련회 연습, 주일예배 연습, 한샘교회 섬김, PU 찬양집회,
      Promise 찬양팀, 예배자스쿨, PW 찬양인도, 7UP, 크리스마스 특순
```

#### ACS (A1:Y1000)
```
설명: Automotive Christian Study
├ 가계부 연동: FILTER 수식으로 거래 가져오기 (현재 데이터 없음 "#N/A")
├ 간트차트 (L~X열):
│  ├ 스터디 구체화 (7~2월)
│  ├ 중간발표 (7~1월)
│  ├ 자기계발 강의 및 포트폴리오 (9~12월)
│  ├ 전시 관람, 사내 강의, 기사 공유 등
│  └ O/x/n 마킹 (O=완료, x=진행중, n=미진행)
├ Y열: 프로젝트 관리 상세 계획서 (GPT 생성 추정)
│  준비작업, 자원할당, 위험관리, 통신프로토콜 등
└ 모임비 항목으로 예산 연동
```

### 간트차트 색상 코딩 체계 (프로젝트 시트 공통)
```
파랑 (#cfe2f3) : 특별 이벤트/일정 (수련회 연습, 예배자스쿨, 7UP 등)
초록 (#d9ead3) : 정기 활동 (일대일, 주일예배 연습 등)
노랑 (#fff2cc) : 팀 활동 (PW 찬양팀 등)
분홍 (#ead1dc) : 집회/모임 (PU 찬양 집회 등)
주황 (#fce5cd) : 장기 프로젝트 (Promise 찬양팀 등)
보라 (#d9d2e9) : 프로그램 (7UP 등)
진초록 (#6aa84f) : 시즌 이벤트 (크리스마스 특순 등)
취소선  : 취소된 일정 (한샘교회 수련회 등)
```

---

## 5. 통계(23.06~24.06) 시트

**범위:** A1:AA1000

### 구조
예산안 시트의 데이터를 참조하여 비율 분석:
```
C열: 비율 (=D열/$D$4)
D열: 예산안 시트에서 직접 참조
  D5: ='25.7~26.6 예산안'!J6    (저축)
  D6: ='25.7~26.6 예산안'!E6:E7 (자동차)
  D7: =sum('25.7~26.6 예산안'!T6:T7) (생활)
  D8: ='25.7~26.6 예산안'!E16   (효도)
  ...

H열: 절대값 기준 비율 분석
  H6: =7200000+2650000+2000000+980000+4000000+1600000
  G열: =H열/$H$6*100 (백분율)

B46: =B42*12+B44+B45 (연간 합계)
```

---

## 6. 입금 내역 / 소비 내역 시트

별도 FILTER 기반 시트로 가계부 내역에서 타입별 필터링

---

## 7. 가계부 내역1 시트

가계부 내역의 보조/백업 시트 (동일 구조)

---

## 전체 데이터 흐름 요약

```
┌─────────────────┐
│  뱅크샐러드 앱   │
│  (Bank Salad)   │
└────────┬────────┘
         │ Excel Export → Gmail
         ▼
┌─────────────────┐
│  OpenClaw 파이프 │
│  라인 (자동화)   │
└────────┬────────┘
         │ 정규화 → 중복제거 → 삽입
         ▼
┌─────────────────────────────────────────────┐
│  가계부 내역 (A~K열: 뱅샐 원본 데이터)        │
│                                              │
│  J열(메모): 프로젝트 대분류 태그               │
│    → IF/K열 수식 또는 수동 입력               │
│    → "효도", "선교", "관계", "찬양" 등         │
│                                              │
│  K열(상세): 예산 항목 태그 (SUMIF 키)          │
│    → 수동 입력 또는 OpenClaw 자동분류          │
│    → "어머니 적금", "식비", "선교 헌금" 등      │
└──────────────┬──────────────────────────────┘
               │
    ┌──────────┼──────────────┐
    │          │              │
    ▼          ▼              ▼
┌────────┐ ┌────────┐  ┌──────────────┐
│프로젝트 │ │예산안   │  │ 뱅샐현황     │
│상세시트 │ │시트    │  │ (독립 데이터) │
│        │ │        │  └──────────────┘
│FILTER  │ │SUMIF   │
│J열=$A1 │ │K열=항목│
│→ 해당  │ │→ 금액  │
│  거래만 │ │  집계  │
│  표시   │ │        │
└────────┘ └────────┘
```

---

## 핵심 설계 패턴 정리

### 1. 이중 태깅 시스템 (J열 + K열)
- **J열 (메모/대분류):** 프로젝트 수준 분류 → 프로젝트 시트의 FILTER 조건
- **K열 (상세/소분류):** 예산 항목 수준 분류 → 예산안의 SUMIF 조건
- 관계: K열 값으로부터 J열을 자동 생성 (IF 중첩 수식)

### 2. 예산 추적 공식
```
남은 예산 = 연간 예산 + SUM(실제 지출)     ← 지출이 음수이므로 자동 차감
여분/부족 = 월예산 × 경과월 + SUM(실제 지출) ← 현재까지 써야 할 만큼 대비 실적
```

### 3. 4열 블록 레이아웃 (예산안)
- 매 5열씩 하나의 카테고리 블록 (A~E, F~J, K~O, P~T)
- 각 블록: [항목명 | 월 | 남은예산 | 여분/부족 | 연예산]
- Row 4~14: 내부 경영 (고정비)
- Row 15~27: 프로젝트 (변동비)

### 4. 프로젝트 시트 공통 구조
- Row 1~4: 예산 요약 (월/남은/부족/연)
- Row 5: 헤더
- Row 7+: `=FILTER('가계부 내역'!A:K, '가계부 내역'!J:J = $A$1)` 로 자동 필터
- L열+: 간트차트 형태의 계획 관리 (월별 O/x/n 마킹)

---

## 발견된 구조적 문제점

### 수식 오류
1. **C13:** `'가계부 내역22'!$K:$K` → 존재하지 않는 시트 참조 (두 예산안 모두 동일 버그)
2. **M20:** `$J:$J` 참조 → 다른 항목은 모두 `$K:$K` (일관성 오류)
3. **B19 (어머니 선물):** 월 예산 수식 누락

### 구조적 한계
4. **IF 중첩 13단계:** J열 수식이 13개 IF 중첩으로 유지보수 어려움 → OpenClaw rules.json이 대체 중
5. **SUMIF 단일 키 의존:** K열 값이 정확히 일치해야만 집계 → 오타/변형에 취약
6. **뱅샐현황 독립:** 뱅크샐러드 리포트 시트와 가계부 내역 사이 수식 연동 없음
7. **하드코딩된 예산:** 예산 금액이 셀에 직접 입력 → 변경 시 여러 곳 수정 필요
8. **4블록 레이아웃 제약:** 프로젝트가 4개 이상 블록에 배치되면 확장 어려움
9. **FILTER 함수 제한:** xlsx 내보내기 시 `__xludf.DUMMYFUNCTION`으로 변환됨 (Google Sheets 전용)
